<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>State tracking - Daptin</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "State tracking";
    var mkdocs_page_input_path = "data-modeling/state_tracking.md";
    var mkdocs_page_url = "/data-modeling/state_tracking/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-114227400-1', 'docs.dapt.in');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Daptin</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../setting-up/settingup/">Setting up</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../setting-up/entities/">Entities</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../setting-up/entity_relations/">Entity relations</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../cloudstore/cloudstore/">Cloud storage</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../subsite/subsite/">Subsites</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../auth/users_and_usergroups/">Users and groups</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../auth/authorization/">Authorization</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../auth/authentication/">Authentication</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../actions-streams/actions/">Actions</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../data_storage/">Data storage</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../setting-up/marketplace/">Market place</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../auditing/">Data auditing</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../data_validation/">Data validation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../data_conformation/">Data conformations</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">State tracking</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#state-tracking-for-entities">State tracking for entities</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#state-machine">State machine</a></li>
        
            <li><a class="toctree-l3" href="#rest-api">REST API</a></li>
        
            <li><a class="toctree-l3" href="#enabling-state-tracking-for-entity">Enabling state tracking for entity</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../actions-streams/streams/">Data streams</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../auth/permissions/">Permission model</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../extend/oauth_connection/">OAuth connections</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../extend/oauth_token/">OAuth tokens</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Daptin</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>State tracking</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="state-tracking-for-entities">State tracking for entities</h1>
<p>Tracking the status of things is one of the most common operation in most business flows. Daptin has a native support for state tracking and allows a lot of convienent features.</p>
<h2 id="state-machine">State machine</h2>
<p>A state machine is a description of "states" which the object can be in, and list of all valid transitions from one state to another. Let us begin with an example:</p>
<p>The following JSON defines a state machine which has (a hypothetical state machine for tracking todos):</p>
<ul>
<li>Initial state: to_be_done</li>
<li>List of valid states: to_be_done, delayed, started, ongoing, interrupted, completed</li>
<li>List of valid transitions, giving name to each event</li>
</ul>
<pre><code class="json">        {
        &quot;Name&quot;: &quot;task_status&quot;,
        &quot;Label&quot;: &quot;Task Status&quot;,
        &quot;InitialState&quot;: &quot;to_be_done&quot;,
        &quot;Events&quot;: [{
                &quot;Name&quot;: &quot;start&quot;,
                &quot;Label&quot;: &quot;Start&quot;,
                &quot;Src&quot;: [
                    &quot;to_be_done&quot;,
                    &quot;delayed&quot;
                ],
                &quot;Dst&quot;: &quot;started&quot;
            },
            {
                &quot;Name&quot;: &quot;delayed&quot;,
                &quot;Label&quot;: &quot;Unable to pick up&quot;,
                &quot;Src&quot;: [
                    &quot;to_be_done&quot;
                ],
                &quot;Dst&quot;: &quot;delayed&quot;
            },
            {
                &quot;Name&quot;: &quot;ongoing&quot;,
                &quot;Label&quot;: &quot;Record progress&quot;,
                &quot;Src&quot;: [
                    &quot;started&quot;,
                    &quot;ongoing&quot;
                ],
                &quot;Dst&quot;: &quot;ongoing&quot;
            },
            {
                &quot;Name&quot;: &quot;interrupted&quot;,
                &quot;Label&quot;: &quot;Interrupted&quot;,
                &quot;Src&quot;: [
                    &quot;started&quot;,
                    &quot;ongoing&quot;
                ],
                &quot;Dst&quot;: &quot;interrupted&quot;
            },
            {
                &quot;Name&quot;: &quot;resume&quot;,
                &quot;Label&quot;: &quot;Resume from interruption&quot;,
                &quot;Src&quot;: [
                    &quot;interrupted&quot;
                ],
                &quot;Dst&quot;: &quot;ongoing&quot;
            },
            {
                &quot;Name&quot;: &quot;completed&quot;,
                &quot;Label&quot;: &quot;Mark as completed&quot;,
                &quot;Src&quot;: [
                    &quot;ongoing&quot;,
                    &quot;started&quot;
                ],
                &quot;Dst&quot;: &quot;completed&quot;
            }
        ]
    }

</code></pre>

<p>State machines can be uploaded to Daptin just like entities and actions. A JSON/YAML file with a <code>StateMachineDescriptions</code> top level key can contain an array of state machine descriptions.</p>
<h2 id="rest-api">REST API</h2>
<h3 id="start-tracking-an-object-by-state-machine-reference-id">Start tracking an object by state machine reference id</h3>
<p>Request</p>
<pre><code>    POST  /track/start/:stateMachineId
    {&quot;typeName&quot;: &lt;entityTypeName&gt;, &quot;referenceId&quot;: &lt;ReferenceIdOfTheObject&gt; }
</code></pre>

<p>Response</p>
<pre><code>        &quot;current_state&quot;: &lt;InitialStateOfTheStateMachine&gt;
        &quot;&lt;typename&gt;_smd&quot;: &lt;ObjectStateInstanceReferenceId&gt;
        &quot;is_state_of_&lt;typename&gt;&quot; = &lt;ObjectInstanceId&gt;
        &quot;permission&quot;: &lt;AuthPermission&gt;
</code></pre>

<h3 id="trigger-an-event-by-name-in-the-state-of-an-object">Trigger an event by name in the state of an object</h3>
<pre><code>    POST  /track/event/:typename/:ObjectStateInstanceReferenceId/:eventName
</code></pre>

<p>Response</p>
<pre><code>        &quot;current_state&quot;: &lt;NewStateAfterEvent&gt;
        &quot;&lt;typename&gt;_smd&quot;: &lt;ObjectStateInstanceReferenceId&gt;
        &quot;is_state_of_&lt;typename&gt;&quot; = &lt;ObjectInstanceId&gt;
</code></pre>

<h2 id="enabling-state-tracking-for-entity">Enabling state tracking for entity</h2>
<p>Begin with marking an entity as trackable. To do this, </p>
<ul>
<li>
<p>go to the world tables page and edit the an entity</p>
</li>
<li>
<p>Check the "Is state tracking enabled" checkbox</p>
</li>
</ul>
<p>This "is_state_tracking_enabled" options tells daptin to create the associated state table for the entity. Even though we have not yet specified which state machines are available for this entity.</p>
<p>To make a state machine available for an entity, go to the "SMD" tab of this entity on the same page and add the state machine by searching it by name and adding it.</p>
<p>It would not make a lot of sense if the above state machine was allowed for all type of entities. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../actions-streams/streams/" class="btn btn-neutral float-right" title="Data streams">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../data_conformation/" class="btn btn-neutral" title="Data conformations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../data_conformation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../actions-streams/streams/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
